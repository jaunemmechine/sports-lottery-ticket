<!DOCTYPE html>
<html class="ui-page-login">

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no,email=no" />
		<title>任选走势图</title>
		<link href="css/mui.min.css" rel="stylesheet" />
		<link href="css/style.css" rel="stylesheet" />
		<link href="css/account.css" rel="stylesheet"/>
		<link href="css/icons-extra.css" rel="stylesheet"/>
		<link href='css/all.css' rel="stylesheet"/>
		<style>
			.mui-bar{padding-left:0;padding-right:0}
			.mui-bar2{padding-left:10px;padding-right:10px}
			.mui-bar-nav ~ .mui-content{padding-top:104px;padding-bottom:245px;background:#fff}
			#table-set>img{vertical-align:middle}
			.mui-bar .mui-segmented-control{top:0}
			.mui-segmented-control{background:#fff;color:#666;border:none}
			.mui-segmented-control .mui-control-item.mui-active{border:none;border-bottom:2px solid #e3393c;background:none;color:#e3393c}
			.mui-segmented-control .mui-control-item{color:#666;border:none;line-height:28px}
			
		</style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav">
			<div class='mui-bar2'> 
			<a class="mui-icon goCenter" id='go-center'><img src="images/userCenter.png"></a> 
			<h1 class="mui-title">走势图</h1>
			<a  class="mui-pull-right mui-icon "><img  class="zoushi" id='go-back' src="images/gomoney.png"></a> 
			</div>
			<div class='table-name'>
				<a class='table-set' id='table-set'  href="#topPopover"><img height='20px'src='images/seticon.png'></a>
				
				<div id="segmentedControl" class="mui-segmented-control">
					<a class="mui-control-item mui-active" href="#item1">
						开奖号码
					</a>
					
					<a class="mui-control-item item-border" href="#item2">
						第一位走势
					</a>
				</div>
				
			</div>
			<div class='table-head'>
				<table class=''>
					<colgroup>
							<col width="60px">											
							<col width="8%">
							<col width="8%">
							<col width="8%"> 
							<col width="8%">
							<col width="8%">
							<col width="8%">
							<col width="8%">
							<col width="8%">
							<col width="8%">
							<col width="8%">
							<col width="8%">
							
						</colgroup>
					<tr>
						<td style='width:59px' id='table-head-qi'>期数</td>
						<td>01</td>
						<td>02</td>
						<td>03</td>
						<td>04</td>
						<td>05</td>
						<td>06</td>
						<td>07</td>
						<td>08</td>
						<td>09</td>
						<td>10</td>
						<td>11</td>
					</tr>
					
				</table>
			</div>
		</header>
		<div class='table-top'>
			
		</div>
		<div class="mui-content" id='mui-content'>	
			<div>
				<div id="item1" class="mui-control-content mui-active">
					<div id="scroll" class="mui-scroll-wrapper">
						<div class="mui-scroll">
							<table class='table-content'>
								<colgroup>
									<col width="60px">											
									<col width="8%">
									<col width="8%">
									<col width="8%"> 
									<col width="8%">
									<col width="8%">
									<col width="8%">
									<col width="8%">
									<col width="8%">
									<col width="8%">
									<col width="8%">
									<col width="8%">
									
								</colgroup> 
								<tbody id='table-list'>
									
										
								</tbody>
							</table>
						</div>
					</div>
				</div>
				<div id="item2" class="mui-control-content">
					<div id="scroll2" class="mui-scroll-wrapper">
						<div class="mui-scroll">
							<table class='table-content'>
								<colgroup>
									<col width="60px">											
									<col width="8%">
									<col width="8%">
									<col width="8%"> 
									<col width="8%">
									<col width="8%">
									<col width="8%">
									<col width="8%">
									<col width="8%">
									<col width="8%">
									<col width="8%">
									<col width="8%">
									
								</colgroup> 
								<tbody id='table-list2'>
									
										
								</tbody>
							</table>
						</div>
					</div>
				</div>
				
			</div>
		</div>
		<!--占时填充底部-->
		<!--底部投注-->
		<nav class="mui-bar mui-bar-tab trend-foot" id='trend-foot'>
			
            
                
            <div class='chip-chose'>
                <span class='make-msg'>选择</span>
                <span class='make make-chose' id='dan'>单</span>
                <span class='make' id='shuang'>双</span>
                <span class='make' id='da'>大</span>
                <span class='make' id='xiao'>小</span>
                <span class='make' id='he'>和</span> 
            </div>
            
		   	<div class='foot-number'>
			  	<div class='in-msg'>投注金币:<input id='all-in' type='number' value="0"> 金币</div>
			  	<div class='btn-in' id='btn-in'>投注</div>
		  	</div>
		</nav>
		<!--设置弹出菜单-->
		<div id="topPopover" class="mui-popover">
			<div class="mui-popover-arrow"></div>
				<ul class="mui-table-view history-ul">
					<li class="mui-table-view-cell" data-href='30'>
						<a href="#">获取最近30期开奖数据</a>
					</li>
					<li class="mui-table-view-cell" data-href='50'><a href="#">获取最近50期开奖数据</a>
					</li>
					<li class="mui-table-view-cell" data-href='100'><a href="#">获取最近100期开奖数据</a>
					</li>
				</ul>
				
			
		</div>
		<script src="js/mui.min.js"></script>
		<script src="js/app.js"></script> 
		<script>
		var qisu;
		var allData;
		(function($, doc) {
				$.init({
					swipeBack:true
				});
				 
				$.plusReady(function() {
					$('.mui-scroll-wrapper').scroll({
						deceleration: 0.0005, //flick 减速系数，系数越大，滚动速度越慢，滚动距离越小，默认值0.0006
						indicators: false
					});
					
				}); 
				//进来渲染数据
				$.ajax(url+'app/lottery/lotteryAward',{
					dataType:'json',
					data:{
						lotteryType:'11选5',
						period:30
					},
					type:'get',
					success:function(data){
						if(data.status=='ok'){
							console.log('成功')
							allData=data;
							var tableList='';
							var tableList2='';
							var array=[1,1,1,1,1,1,1,1,1,1,1,1]
							//取5个号码
							for(var i=0;i<data.rows.length;i++){
								var number=data.rows[i].periods.substring(6,8)
								tableList +='<tr><td>'+number+'期</td>'
								for(var t=1;t<=11;t++){
									var temp=t<10?"0"+t:t;
									if(data.rows[i].awardNumber.indexOf(temp)>=0){
										tableList +='<td><span class="red-ball">'+temp+'</span></td>'										
									 	array[t]=1;
									}else{
										tableList +='<td>'+array[t]+'</td>'
										array[t]+=1
									}	
								}
								
							}
							document.getElementById('table-list').innerHTML=tableList
							//取第一个号码
							for(var i=0;i<data.rows.length;i++){
								var number=data.rows[i].periods.substring(6,8)
								tableList2 +='<tr><td>'+number+'期</td>'
								for(var t=1;t<=11;t++){
									var temp=t<10?"0"+t:t;
									if(data.rows[i].awardNumber.substring(0,3).indexOf(temp)>=0){
										tableList2 +='<td><span class="red-ball">'+temp+'</span></td>'										
									 	array[t]=1;
									}else{
										tableList2 +='<td>'+array[t]+'</td>'
										array[t]+=1
									}	
								}
								
							}
							document.getElementById('table-list2').innerHTML=tableList2
						}else{
							 
						}
					}, 
					error:function(xhr,type,errorThrown){
						console.log('错了')
					}
				});
				/*任选*/
				$(".all-list").on('tap','.all-ball',function(){
					if(this.getAttribute('class').indexOf('all-ball-chose') > -1){
						this.setAttribute('class','all-ball');
					}else{
						var chose=document.querySelectorAll('.all-ball-chose')
						if(chose.length<5){
							this.setAttribute('class','all-ball all-ball-chose');
						}else{
							mui.toast('最多不能超过5个')	
						}												
					}
				})
				/*设置*/ 
				$(".history-ul").on('tap','.mui-table-view-cell',function(){
					var href=this.getAttribute('data-href').toLowerCase();
					console.log(href);
					/*隐藏设置*/
					mui('#topPopover').popover('toggle')
					//获取走势图数据
					$.ajax(url+'app/lottery/lotteryAward',{
						dataType:'json', 
						data:{
							lotteryType:'11选5',
							period:href
						},
						type:'get',
						success:function(data){
							if(data.status=='ok'){
								allData=data;
								var tableList=''
								var tableList2=''
								var array=[1,1,1,1,1,1,1,1,1,1,1,1]
								for(var i=0;i<data.rows.length;i++){
									var number=data.rows[i].periods.substring(6,8)
									tableList +='<tr><td>'+number+'期</td>'
									for(var t=1;t<=11;t++){
										var temp=t<10?"0"+t:t;
										if(data.rows[i].awardNumber.indexOf(temp)>=0){
											tableList +='<td><span class="red-ball">'+temp+'</span></td>'
										 	array[t]=1;
										}else{
											tableList +='<td>'+array[t]+'</td>'
											array[t]+=1
										}	
									}
									
								}
								document.getElementById('table-list').innerHTML=tableList
								//取第一位数字
								for(var i=0;i<data.rows.length;i++){
									var number=data.rows[i].periods.substring(6,8)
									tableList2 +='<tr><td>'+number+'期</td>'
									for(var t=1;t<=11;t++){
										var temp=t<10?"0"+t:t;
										if(data.rows[i].awardNumber.substring(0,3).indexOf(temp)>=0){
											tableList2 +='<td><span class="red-ball">'+temp+'</span></td>'
										 	array[t]=1;
										}else{
											tableList2 +='<td>'+array[t]+'</td>'
											array[t]+=1
										}	
									}
								}
								document.getElementById('table-list2').innerHTML=tableList2
							}else{
								 
							}
						}, 
						error:function(xhr,type,errorThrown){
							console.log('错了')
						}
					});
				})
				/*去投注*/								
				//投注金额正则判断
				allIn=document.getElementById('all-in')
				allIn.addEventListener('input',function(){
					var reg = /^[1-9]{1}([0-9]+)?$/;
					var r=allIn.value.match(reg)
					if(r==null){
						allIn.value=''
					}else{
						
					}
				})
				//获得期数
				$.ajax(url+'app/lottery/selectPeriod',{
					dataType:'json',
					type:'post', 
					success:function(data){
						if(data.status=='ok'){ 
							console.log(parseInt(parseInt(data.mapInfo.seconds)/60))
							if(parseInt(parseInt(data.mapInfo.seconds)/60<4)){
								qisu=data.mapInfo.period+1
							}else{
								qisu=data.mapInfo.period
							}
							console.log(qisu)
						}else{
							qisu=data.mapInfo.period
							console.log(data.status+data.info) 
							plus.nativeUI.toast(data.info)
						}
					},
					error:function(xhr,type,errorThrown){
						console.log('错了')
					}
				});
				//下注
				document.getElementById('btn-in').addEventListener('tap',function(){
					if(himall.isLogin()){
						var userState = JSON.parse(localStorage.getItem('$state') || "{}");
						var token=userState.token;
						var dan1=document.querySelectorAll('.all-ball-chose')
						var cathecticNumber='0';
						var allIn=document.getElementById('all-in'); 
						var overQi=document.getElementById('over-qi')				
						//投注金额判断
						if(allIn.value<=0){
							plus.nativeUI.toast('投注金额不能为0')
							return;
						}else{
							var dan=document.querySelector('.make-chose');
						  	console.log(dan.innerHTML+'dan')
							switch (dan.innerHTML)
							{
								case '单':
									cathecticType='single'
								  	break;
								case '双':
								 	cathecticType='double';
								  	break;
								case '小':
								 	cathecticType='small';
								 	break;
								case '大':
								 	cathecticType='large';	
								 	break;
								case '和':
								 	cathecticType='draw';
								 	break;
								default:		
								  	return;
							} 
																			
							$.ajax(url+'app/lottery/addLotteryCathectic',{
								dataType:'json',
								data:{
									lotteryType:'11选5',
									cathecticMoney:allIn.value,
									periods:qisu, 
									cathecticType:cathecticType,
									cathecticNumber:cathecticNumber,
									token:token, 
								}, 
								type:'post', 
								success:function(data){
									if(data.status=='ok'){
										plus.nativeUI.toast('提交成功')	
										himall.openVW('allinList.html');
									}else{
										console.log(data.status+data.info) 
										plus.nativeUI.toast(data.info)
									}
								},
								error:function(xhr,type,errorThrown){
									console.log('错了')
								}
							});
						}							
					}else{
						plus.nativeUI.toast('请先登录')
						showLogin('','');		 					    
						return;
					}
				})
				/*去主页*/
				document.getElementById('go-back').addEventListener('tap',function(){
					mui.back()
				})
				/*去个人中心*/	
				document.getElementById('go-center').addEventListener('tap',function(){
					himall.openVW('userCenter.html')
				})
				/*单双大小和投注*/
				$(".chip-chose").on('tap','.make',function(){
										
					if(this.getAttribute('class').indexOf('make-chose') > -1){
						this.setAttribute('class',' make');
					}else{
						var make=document.querySelector('.make-chose')
						if(make){
							make.setAttribute('class','make')
						}						
						this.setAttribute('class','make-chose make');
					}					
				})
				$('#scroll').scroll({
				indicators: false //是否显示滚动条
				});
				$('#scroll2').scroll({
				indicators: false //是否显示滚动条
				});
				
				
 		}(mui, document));	
 		/*动态设置table头部宽度*/ 
		var style=document.getElementById('table-head-qi')
//					console.log(window.getComputedStyle(style, null).width)
		var width=window.getComputedStyle(style, null).width
		document.getElementById('table-set').style.width=width
		/*动态设置区域滚动*/	 
		var style2=document.getElementById('trend-foot')
		console.log(window.getComputedStyle(style2, null).height)
		var height1=window.getComputedStyle(style2, null).height
		console.log(height1+'height1');
		console.log('为什么要进来两次'); 
		/*动态设置滚动区域*/
		var style=document.getElementById('mui-content')
//					console.log(window.getComputedStyle(style, null).height)
		var height=window.getComputedStyle(style, null).height
//					console.log(height);
		var h=height.indexOf('p')
		var h1=height.indexOf('p')
//					console.log(h) 
		height=height.substr(0,h);
		height1=height1.substr(0,h1);
//					console.log(height)
		height=height-104-height1
		height=height+'px' 
		console.log(height) 
		document.getElementById('item1').style.height=height
		document.getElementById('item2').style.height=height 
		
		
		</script>
	</body>

</html>